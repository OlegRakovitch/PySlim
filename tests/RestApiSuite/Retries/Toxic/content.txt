#|import            |
#|Scripts.http_calls|

!define TOXIC_PORT_CONTROL (8474)
!define TOXIC_PORT (4000)



!define TOXIC_PROXY_CONTROL (!-http://toxic_proxy-!:${TOXIC_PORT_CONTROL})

!define TOXIC_PROXY (!-http://toxic_proxy-!:${TOXIC_PORT})

Configure proxy

!|post     |${TOXIC_PROXY_CONTROL}/proxies      |
|name      |listen          |upstream           |
|jsonserver|toxic_proxy:4000|py_slim_server:3000|



!|query:last response as table|
|status_code            |body |
|=~!-/((201)|(409))-!/  |     |

!|Subset Query:http result as table|${TOXIC_PROXY_CONTROL}/proxies|
|jsonserver                                                       |


!|script               |
|Array Field|jsonserver|

!|Subset Query:http result as table|${TOXIC_PROXY_CONTROL}/proxies |
|name                              |list|toxics|upstream           |
|jsonserver                        |    |      |py_slim_server:3000|


!|Subset Query:http result as table|${TOXIC_PROXY_CONTROL}/proxies/jsonserver|
|name                              |list    |toxics   |upstream              |
|jsonserver                        |        |         |py_slim_server:3000   |

!|query:last response as table|
|status_code       |body      |
|200               |          |

Configure side effects

!|post  |${TOXIC_PROXY_CONTROL}/proxies/jsonserver/toxics|
|name   |type                                            |
|fragile|limit_data                                      |

!|query:last response as table|
|status_code            |body |
|=~!-/((201)|(409))-!/  |     |


!|post    |${TOXIC_PROXY}/users        |
|FirstName|LastName|IsMafia|Age        |
|Tony     |Soprano |True   |22         |
|Jennifer |Melfi   |False  |{"Real":33}|


!|Query:http result as table|${TOXIC_PROXY}/users|
|FirstName                  |LastName|IsMafia|Age|
|Tony                       |Soprano |True   |   |
|Jennifer                   |Melfi   |False  |   |
